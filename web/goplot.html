<!DOCTYPE html>

<html>

<!-- Page header -->

<head>
    <title>Go-Plot</title>

    <link rel="stylesheet" href="/plot/css/bootstrap.min.css">
    </link>
</head>

<!-- Page body -->

<body>
    <div class="container-fluid">
        <!-- Navigation bar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container-fluid">
                &nbsp;
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(255,255,255)"
                    class="bi bi-vector-pen" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" style="stroke:rgb(255,255,255);stroke-width:1"
                        d="M10.646.646a.5.5 0 0 1 .708 0l4 4a.5.5 0 0 1 0 .708l-1.902 1.902-.829 3.313a1.5 1.5 0 0 1-1.024 1.073L1.254 14.746 4.358 4.4A1.5 1.5 0 0 1 5.43 3.377l3.313-.828L10.646.646zm-1.8 2.908-3.173.793a.5.5 0 0 0-.358.342l-2.57 8.565 8.567-2.57a.5.5 0 0 0 .34-.357l.794-3.174-3.6-3.6z" />
                    <path fill-rule="evenodd" style="stroke:rgb(255,255,255);stroke-width:1"
                        d="M2.832 13.228 8 9a1 1 0 1 0-1-1l-4.228 5.168-.026.086.086-.026z" />
                </svg>
                &nbsp;
                <a class="navbar-brand" href="#">Go-Plot</a>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                                aria-expanded="false">
                                Plot View
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="showMathFunctionPlot();">Math
                                        Fucntion Plot</a>
                                <li>
                                <li><a class="dropdown-item" href="#" onclick="showDataSetPlot();">Data Set Plot</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Application Container -->
        <div id="container">
            <div class="row">&nbsp;</div>
            <div class="row">
                <!-- a card for the math function plot parameters -->
                <div class="col" id="mathPlotParameters">
                    <div class="card">
                        <h5 class="card-header">Plot Parameters</h5>

                        <div class="card-body">
                            <form class="row g-3">
                                <div class="col-12">
                                    <label for="math-plot-title" class="form-label">Title</label>
                                    <input type="text" class="form-control" id="math-plot-title"
                                        aria-describedby="math-plot-title-help" />
                                    <div id="math-plot-title-help" class="form-text">Plot's title</div>
                                </div>
                                <div class="col-md-6">
                                    <label for="min-x" class="form-label">Min X</label>
                                    <input type="text" aria-label="min-x-help" class="form-control" id="min-x" />
                                    <div id="min-x-help" class="form-text">Initial value for X variable</div>
                                </div>
                                <div class="col-md-6">
                                    <label for="max-x" class="form-label">Max X</label>
                                    <input type="text" aria-label="max-x-help" class="form-control" id="max-x">
                                    <div id="max-x-help" class="form-text">Final value for X variable</div>
                                </div>
                                <div class="col-12">
                                    <label for="function" class="form-label">Fuction</label>
                                    <input type="text" class="form-control" id="function"
                                        aria-describedby="function-help">
                                    <div id="function-help" class="form-text">Mathematical expression to plot</div>
                                </div>

                                <div class="col-md-3">
                                    <button type="submit" class="btn btn-primary"
                                        onclick="doMathFuncionPlot();">Plot</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- a card for the data set plot parameters -->
                <div class="col" id="dataSetPlotParameters">
                    <div class="card">
                        <h5 class="card-header">Plot Parameters</h5>

                        <div class="card-body">
                            <form class="row g-3">
                                <div class="col-12">
                                    <label for="dataset-title" class="form-label">Title</label>
                                    <input type="text" class="form-control" id="dataset-title"
                                        aria-describedby="dataset-title-help" />
                                    <div id="dataset-title-help" class="form-text">Plot's title</div>
                                </div>
                                <div class="mb-3">
                                    <label for="point-style" class="form-label">Point Style</label>
                                    <select class="form-select" id="point-style" aria-describedby="point-style-help">
                                        <option value="boxes">Boxes</option>
                                        <option value="dots">Dots</option>
                                        <option value="lines">Lines</option>
                                        <option value="linespoints">Lines & Points</option>
                                        <option value="points">Points</option>
                                    </select>
                                    <div id="point-style-help" class="form-text">Plot's point style</div>
                                </div>
                                <div class="mb-3">
                                    <label for="dataSet" class="form-label">Data Set</label>
                                    <textarea class="form-control" id="dataSet" rows="5"
                                        aria-describedby="dataSet-help"></textarea>
                                    <div id="dataSet-help" class="form-text">Plot's data set</div>
                                </div>
                                <div class="col-md-6">
                                    <label for="column-x" class="form-label">Column X</label>
                                    <input type="text" aria-label="column-x-help" class="form-control" id="column-x" />
                                    <div id="column-x-help" class="form-text">Column for X variable</div>
                                </div>
                                <div class="col-md-6">
                                    <label for="column-y" class="form-label">Column Y</label>
                                    <input type="text" aria-label="column-y-help" class="form-control" id="column-y" />
                                    <div id="column-y-help" class="form-text">Column for Y variable</div>
                                </div>

                                <div class="col-md-3">
                                    <button type="submit" class="btn btn-primary"
                                        onclick="doDataSetPlot();">Plot</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- a card for the plot canvas -->
                <div class="col">
                    <div class="card">
                        <h5 class="card-header">Plot Graphic</h5>
                        <div class="card-body">
                            <canvas id="canvas_plot" width=600 height=400>
                                <div id="err_msg">No support for HTML 5 canvas element</div>
                            </canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="/plot/js/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="/plot/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="/plot/js/axios.min.js"></script>

    <script content="text/javascript">
        function showMathFunctionPlot() {
            $('#mathPlotParameters').show();
            $('#dataSetPlotParameters').hide();
        }

        function doMathFuncionPlot() {

            let title = $('#math-plot-title').val();
            let min_x = Number($('#min-x').val());
            let max_x = Number($('#max-x').val());
            let math_function = $('#function').val();

            const GOPLOT_API_URL = '/plot/api/canvas';
            const REQUEST_HEADERS = {
                'Content-Type': 'application/json',
            };
            const plotRequest = {
                plot: [
                    {
                        title: title,
                        function: math_function,
                        min_x: min_x,
                        max_x: max_x,
                    },
                ],
            };
            console.debug('request payload: ' + JSON.stringify(plotRequest))

            //  send a request to the server
            axios.post(GOPLOT_API_URL, plotRequest, { headers: REQUEST_HEADERS })
                .then(response => {
                    const canvasScript = response.data;

                    eval(canvasScript);
                    canvas_plot();
                })
                .catch(error => console.error('On Generating Go-Plot Graphic', error));
        }

        function showDataSetPlot() {
            $('#mathPlotParameters').hide();
            $('#dataSetPlotParameters').show();
        }

        function doDataSetPlot() {

            let title = $('#dataset-title').val();
            let style = $('#point-style').val();
            let column_x = Number($('#column-x').val());
            let column_y = Number($('#column-y').val());
            let dataSet = $('#dataSet').val();
            let lines = dataSet.split("\n");
            let points = [];

            //  parse dataset to get points data
            lines.forEach(line => {
                let linePoints = line.split(" ");

                points.push({
                    x: Number(linePoints[column_x - 1]),
                    y: Number(linePoints[column_y - 1]),
                });
            });

            const GOPLOT_API_URL = '/plot/api/canvas';
            const REQUEST_HEADERS = {
                'Content-Type': 'application/json',
            };
            const plotRequest = {
                plot: [
                    {
                        title: title,
                        style: style,
                        points: points,
                    },
                ],
            };
            console.debug('request payload: ' + JSON.stringify(plotRequest))

            //  send a request to the server
            axios.post(GOPLOT_API_URL, plotRequest, { headers: REQUEST_HEADERS })
                .then(response => {
                    const canvasScript = response.data;

                    eval(canvasScript);
                    canvas_plot();
                })
                .catch(error => console.error('On Generating Go-Plot Graphic', error));
        }

        $('#mathPlotParameters').show();
        $('#dataSetPlotParameters').hide();
    </script>
</body>

</html>
